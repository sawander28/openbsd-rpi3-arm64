# /etc/pf.conf - minimal router/firewall with NAT for a LAN

# Interfaces and networks
lan_if = "exon0"
lan_net = "10.0.0.0/24"
vm_net = "172.16.0.0/12"

# Non-routable and reserved address space
table <martians> { 0.0.0.0/8, 10.0.0.0/8, 127.0.0.0/8, 169.254.0.0/16,
                   172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 198.18.0.0/15,
                   198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/3, 192.168.0.0/16 }

# Default behaviors
set block-policy drop
set loginterface egress
set skip on lo

# Normalize traffic
match in all scrub (no-df random-id max-mss 1440)

# NAT for LAN to the current egress address
match out on egress inet from $lan_net to any nat-to (egress:0)

# Anti-spoofing
antispoof quick for { egress, $lan_if }
block in  quick on egress from <martians> to any
block out quick on egress from any to <martians> return

# Default deny
block all

# Allow established and related traffic
pass out on egress inet keep state

# Allow LAN to anywhere
pass in on $lan_if inet from $lan_net to any keep state
